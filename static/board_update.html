<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>My Blog - 게시글 작성</title>

    <script src="https://code.jquery.com/jquery-3.5.1.js" integrity="sha256-QWo7LDvxbWT2tbbQ97B53yJnYU3WhH/C8ycbRAkjPDc="
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"
        integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.min.js"
        integrity="sha384-w1Q4orYjBQndcko6MimVbzY0tgp4pWB4lZ7lr30WKz0vr/aWKhXdBNmNb5D92v7s"
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.js"></script>
    <script src="https://cdn.socket.io/socket.io-3.0.1.min.js"></script>

</head>
<body>
    <div align="center">
        <table>
            <tr align="right">
                <td colspan="2"><button id="btnDelete">삭제하기</button></td>
            </tr>
            <tr>
                <td>제목</td>
                <td><input type="text" id="ipTitle"></td>
            </tr>
            <tr>
                <td>작성자</td>
                <td><input type="text" id="ipRegId"></td>
            </tr>
            <tr>
                <td>패스워드</td>
                <td><input type="password" id="ipPassword"></td>
            </tr>
            <tr>
                <td>글 내용</td>
                <td><textarea style="width: 500px; height: 200px;" id="taContent"></textarea></td>
            </tr>
        </table>
    </div>
    <div align="center">
        <button id="btnSave">수정하기</button>
        <button onclick="window.location.href='/'">돌아가기</button>
    </div>

    <script src="/api.js"></script>
    <script>

        function getParameter(name) {
            name = name.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]");
            var regex = new RegExp("[\\?&]" + name + "=([^&#]*)"),
                results = regex.exec(location.search);
            return results === null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
        }

        $(document).ready(function () {

            requestBoardDetail(getParameter("boardId"), (response) => {
                $('#ipTitle').val(response.title);
                $('#ipRegId').val(response.regid);
                $('#taContent').val(response.content);
            })

            $("#btnSave").on("click", function () {
                requestBoardUpdate($('#ipTitle').val(), $('#ipRegId').val(), $('#ipPassword').val(), $('#taContent').val(), getParameter("boardId"), (response) => {
                    if(response.success === true){
                        alert('게시글이 수정되었습니다.');
                        window.location.href = "/index.html";
                    }
                });
            });

            $("#btnDelete").on("click", function () {
                requestBoardDelete(getParameter("boardId"), $('#ipPassword').val(), (response) => {
                    if(response.success === true){
                        alert('게시글이 삭제되었습니다.');
                        window.location.href = "/index.html";
                    }
                });
            });

        });

    </script>
</body>
</html>